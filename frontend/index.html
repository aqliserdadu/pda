<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PDA Dashboard</title>

    <!-- Favicon -->
    <link rel="shortcut icon" type="image/png" href="/images/logo.png" />

    <!-- Stylesheets -->
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

    <!-- JS Libraries -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <!-- Tambahkan ke head -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

</head>

<body>
    <header>
        <div class="header-left">
            <img src="/images/logo.png" alt="HAS Logo" class="logo" />
        </div>
        <div class="header-center">
            <h1>Pemantauan Duga Air</h1>
        </div>
        <div class="header-right">
            <span id="map-location">Location: -</span>
        </div>
        <div style="position: absolute; top: 80px; right: 20px; z-index: 999;">
            <button id="wifi-icon-btn" class="btn btn-outline-secondary position-relative" data-bs-toggle="modal"
                data-bs-target="#wifiModal" title="Pilih Jaringan WiFi">
                <img src="https://img.icons8.com/ios-filled/24/000000/wifi.png" alt="WiFi Icon" />
                <span id="wifi-status-dot"
                    style="position: absolute; top: 2px; right: 2px; width: 10px; height: 10px; background-color: gray; border-radius: 50%; border: 1px solid white;"></span>
            </button>
        </div>
    </header>

    <main>
        <!-- Cards -->
        <div class="cards-full-grid">
            <!-- Parameter Kualitas Air -->
            <div class="card" id="pH-card"><span class="label">pH</span><span id="ph-value">-</span><span
                    class="unit"></span><span class="timestamp">-</span></div>
            <div class="card" id="press-card"><span class="label">Water Preassure</span><span id="press-value">-</span><span
                    class="unit">psi</span><span class="timestamp"></span></div>
            <div class="card" id="orp-card"><span class="label">ORP</span><span id="orp-value">-</span><span
                    class="unit">mV</span><span class="timestamp">-</span></div>
            <div class="card" id="tds-card"><span class="label">TDS</span><span id="tds-value">-</span><span
                    class="unit">ppm</span><span class="timestamp">-</span></div>
            <div class="card" id="conduct-card"><span class="label">Conductivity</span><span
                    id="conduct-value">-</span><span class="unit">µS/cm</span><span class="timestamp">-</span></div>
            <div class="card" id="do-card"><span class="label">Dis. Oxygen</span><span id="do-value">-</span><span
                    class="unit">mg/L</span><span class="timestamp">-</span></div>
            <div class="card" id="salinity-card"><span class="label">Salinity</span><span
                    id="salinity-value">-</span><span class="unit">ppt</span><span class="timestamp">-</span></div>
            <div class="card" id="nh3n-card"><span class="label">Ammonia</span><span id="nh3n-value">-</span><span
                    class="unit">mg/L</span><span class="timestamp">-</span></div>
            <div class="card" id="turb-card"><span class="label">Turbidity</span><span id="turb-value">-</span><span
                    class="unit">NTU</span><span class="timestamp">-</span></div>
            <div class="card" id="tss-card"><span class="label">TSS</span><span id="tss-value">-</span><span
                    class="unit">mg/L</span><span class="timestamp">-</span></div>
            <div class="card" id="cod-card"><span class="label">COD</span><span id="cod-value">-</span><span
                    class="unit">mg/L</span><span class="timestamp">-</span></div>
            <div class="card" id="bod-card"><span class="label">BOD</span><span id="bod-value">-</span><span
                    class="unit">mg/L</span><span class="timestamp">-</span></div>
            <div class="card" id="no3-card"><span class="label">Nitrate</span><span id="no3-value">-</span><span
                    class="unit">mg/L</span><span class="timestamp">-</span></div>
            <div class="card" id="temp-card"><span class="label">Temperature</span><span id="temp-value">-</span><span
                    class="unit">°C</span><span class="timestamp">-</span></div>

            <!-- Parameter Perangkat -->
            <div class="card" id="battery-card"><span class="label">Battery</span><span id="battery-value">-</span><span
                    class="unit">V</span><span class="timestamp">-</span></div>
            <div class="card" id="depth-card"><span class="label">Depth</span><span id="depth-value">-</span><span
                    class="unit">cm</span><span class="timestamp"></span></div>
            <div class="card" id="flow-card"><span class="label">Flow</span><span id="flow-value">-</span><span
                    class="unit">m³/s</span><span class="timestamp">-</span></div>
            <div class="card" id="tflow-card"><span class="label">Total Flow</span><span id="tflow-value">-</span><span
                    class="unit">m³</span><span class="timestamp">-</span></div>
        </div>

        <!-- Control Panel -->
        <div class="row">
            <div class="col-md-6">
                <label for="param-select">Pilih Parameter:</label>
                <select id="param-select" class="form-select"></select>
            </div>
            <div class="col-md-6">
                <label for="time-range">Rentang Waktu:</label>
                <select id="time-range" class="form-select">
                    <option value="realtime">Realtime (15 Menit)</option>
                    <option value="1h">1 Jam</option>
                    <option value="12h">12 Jam</option>
                    <option value="1d">1 Hari</option>
                    <option value="3d">3 Hari</option>
                    <option value="7d">7 Hari</option>
                </select>

            </div>

        </div>

        <!-- Chart & Map -->
        <div class="chart-map-wrapper">
            <div class="chart-container">
                <div id="dataChart" style="width: 100%; height: 350px;"></div>
            </div>
            <div class="map-container">
                <div id="map" style="height: 350px;"></div>
            </div>
        </div>

        <!-- Export & Control -->
        <div class="container my-4">
            <div class="row g-3 align-items-end">
                <div class="col-md-3">
                    <label for="start-datetime" class="form-label">Start:</label>
                    <input type="datetime-local" class="form-control" id="start-datetime" step="any">
                </div>
                <div class="col-md-3">
                    <label for="end-datetime" class="form-label">End:</label>
                    <input type="datetime-local" class="form-control" id="end-datetime" step="any">
                </div>
                <div class="col-md-2">
                    <label for="export-destination" class="form-label">Export to:</label>
                    <select id="export-destination" class="form-select">
                        <option value="download">Download</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <button id="export-btn" class="btn btn-success w-100"> <i class="bi bi-download me-2"></i> Export
                        Data</button>

                </div>
                <div class="col-md-2">
                    <div id="export-status" class="form-text mt-1"></div>
                </div>
                <div class="col-md-6 mt-3">
                    <button id="restart-btn" class="btn w-100 text-white" style="background-color: rgb(250, 185, 6);">
                        <i class="bi bi-arrow-clockwise me-2"></i> Restart Device</button>
                </div>
                <div class="col-md-6 mt-3">
                    <button id="shutdown-btn" class="btn btn-danger w-100"> <i class="bi bi-power me-2"></i> Shutdown
                        Device</button>
                </div>
            </div>
        </div>
    </main>

    <!-- WiFi Modal -->
    <div class="modal fade" id="wifiModal" tabindex="-1" aria-labelledby="wifiModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form id="wifi-form">
                    <div class="modal-header">
                        <h5 class="modal-title" id="wifiModalLabel">Pilih Jaringan WiFi</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Tutup"></button>
                    </div>
                    <div class="modal-body">
                        <div class="alert alert-info p-2" id="wifi-current-status">Status: Memeriksa...</div>
                        <div class="mb-3">
                            <label for="ssid" class="form-label">SSID</label>
                            <select class="form-select" id="ssid" required>
                                <option>Memuat...</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="wifi-password" class="form-label">Password</label>
                            <input type="password" class="form-control" id="wifi-password"
                                placeholder="Password (jika perlu)" />
                        </div>
                        <div id="wifi-status" class="text-muted small"></div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">Hubungkan</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <footer class="dashboard-footer">
        <div class="footer-section left" id="footer-device">Device: -</div>
        <div class="footer-section center" id="footer-copy">Copyright © 2025 Has Environmental</div>
        <div class="footer-section right" id="footer-version">V: -</div>
    </footer>

    <script src="/js/script.js"></script>
    <script>

        flatpickr("#start-datetime", {
            enableTime: true,
            dateFormat: "Y-m-d H:i",
            time_24hr: true,
            defaultDate: new Date() // Menampilkan waktu sekarang saat awal load
        });

        flatpickr("#end-datetime", {
            enableTime: true,
            dateFormat: "Y-m-d H:i",
            time_24hr: true,
            defaultDate: new Date() // Menampilkan waktu sekarang juga
        });
    </script>
</body>

</html>